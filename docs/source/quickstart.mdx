---
title: Apollo Federation Quickstart
subtitle: Create a federated GraphQL API with Apollo Federation
description: Create a federated GraphQL API with Apollo Federation
---

Apollo Federation streamlines the integration of microservices, enabling real-time access to product, inventory, and customer data across client applications.
This quickstart guides you through setting up a federated GraphQL API using a demo retail supergraph.
To learn more about Apollo Federation and the benefits of using it with GraphOS, check out these resources:

- [Introduction to Apollo Federation](./)
- [Introduction to GraphOS](/graphos)

## Prerequisites

To complete this quickstart, you must have the following:

- A [GraphOS Studio](https://studio.apollographql.com/?referrer=docs-content) account
- A local version of Apollo's retail demo supergraph—you can download or clone it from its [GitHub repository](https://github.com/apollosolutions/retail-supergraph)
- The latest LTS version of [Node](https://nodejs.org/en)

If you haven't already, set these up before continuing.

## Overview

Locally running a federated GraphQL API with GraphOS takes a few steps:

1. Install and authenticate the Rover CLI.
2. Start local development.
3. Publish your subgraph schemas.
4. Query your supergraph.

### Step 1. Install and authenticate the Rover CLI

_Rover_ is Apollo's CLI for managing all kinds of graphs, including subgraphs and supergraphs. You'll use it throughout this quickstart.

<Note>

Even if you already have Rover installed, update your version by completing this step.

</Note>

Install the latest Rover release with the appropriate command for your system:

```bash title="MacOS / Unix-like" showLineNumbers=false
curl -sSL https://rover.apollo.dev/nix/latest | sh
```

```bash title="Windows" showLineNumbers=false
iwr 'https://rover.apollo.dev/win/latest' | iex
```

After installing, run `rover -V` in your terminal to confirm that it installed successfully.
Verify that the printed version number matches the [latest release](https://github.com/apollographql/rover/releases).
If it doesn't, you might need to manually delete a previous outdated installation.

To use the Rover CLI to manage graphs in GraphOS Studio, you first need to authenticate it.
This entails obtaining an API key and providing it to Rover.

<ObtainPersonalApiKey />

You can provide your API key to Rover either via the `config auth` command or by setting an environment variable.
The `config auth` command is intended for local development so it's appropriate for this tutorial. Run the command:

```shell showLineNumbers=false
rover config auth
```

Then copy your personal API key into the prompt when requested.

<Note>

The `auth` command is interactive to prevent your API key from appearing in your terminal command history.

</Note>

### Step 2. Start local development

To start local development, you first need to get the retail demo supergraph up and running.
From the root directory, install dependencies:

```bash
npm install
```

Then run the subgraphs:

```bash
npm run dev:subgraphs
```

Now you can use Rover to start the supergraph locally.
Specifically, the `rover dev` command starts the supergraph's router.
You can use the `dev` command with the `--supergraph-config` option to provide the router's configuration.
The `retail-supergraph.yaml` is a [YAML configuration file](/rover/commands/dev#starting-a-session-with-multiple-subgraphs) that includes subgraph names, URLs, and schemas for the retail demo supergraph.

In a separate terminal window, run this command:

```bash title="Example configuration command" showLineNumbers=false
rover dev --supergraph-config supergraph-config-dev.yaml
```

When you first start the `rover dev` process, you'll see the following in the terminal:

1. Rover obtains the provided subgraph schemas and starts sessions for each of them.
2. Rover uses Apollo Federation to compose a supergraph schema from the subgraph schemas.
3. Rover starts a locally running router session and provides it with the supergraph schema.
4. Rover starts watching the provided subgraph schema for changes. It recomposes the supergraph schema whenever it detects one. Recomposition automatically reloads the router.

Congrats! You've now got a supergraph running locally.
Next, you'll publish your subgraph schemas to Studio to make your supergraph externally accessible.

<Note>

You can stop your initial `rover dev` process by pressing `CTRL+C`. This shuts down the local router session and any secondary `rover dev` processes attached to that same session.

</Note>

### Step 3. Publish your subgraph schemas

You individually publish each subgraph's schema to GraphOS with the `rover subgraph publish` command.

Whenever you publish a subgraph schema, GraphOS attempts to compose all the latest versions of your subgraph schemas into a single supergraph schema for your router.
If this composition succeeds, your router is updated with the result.

Assuming you're using the retail demo supergraph and its included subgraph schemas, you can use the following commands:

1. Paste the following multi-line command into your terminal, but don't run it—you must modify it first.

    ```bash showLineNumbers=false
    rover subgraph introspect https://retail-demo-products-subgraph.com/ | \
    rover subgraph publish --name products \
    --routing-url https://retail-demo-products-subgraph.com/ \
    --schema - <GRAPH_REF>
    ```

2. In your terminal, replace the final value `<GRAPH_REF>` with the appropriate value for your graph.  A graph ref uniquely identifies a particular _variant_ of a particular graph in GraphOS. Every graph ref is a string with the following format:

    `graph-id@variant-name`

    - The value before the `@` is your graph's unique ID in GraphOS.
    - The value after the `@` is the name of the graph variant you're interacting with.

    Each variant of a graph represents a different environment where that graph runs (such as staging and production). For this quickstart, you can keep the default suggested variant name or change it to anything else you like (for example, `quickstart`).

    After you've published a schema to a particular variant, that variant's graph ref is always available at the top of its README page.

3. Run the modified command.

    - If the command is successful, you'll see output like the following:

      ```
      A new subgraph called 'products' was created in 'docs-example-graph@main'
      The supergraph schema for 'docs-example-graph@main' was updated, composed from the updated 'products' subgraph
      ```

    - If the command fails, make sure you've [authenticated Rover with GraphOS](#step-2-install-and-authenticate-the-rover-cli). All Rover commands that interact with GraphOS require a valid API key.

    If you open your graph's details in Studio now, you'll see types and fields from the `products` subgraph listed on the **Schema** page.

4. Do the same thing for the `orders` subgraph, again substituting your graph ref:

    ```bash showLineNumbers=false
    rover subgraph introspect https://retail-demo-orders-subgraph.com/ | \
    rover subgraph publish --name orders \
    --routing-url https://retail-demo-orders-subgraph.com/ \
    --schema - <GRAPH_REF>
    ```

    You only need to provide a subgraph's `--routing-url` the first time you publish that subgraph's schema to a particular variant unless the URL later changes.


Whenever you publish a subgraph schema, GraphOS automatically composes all subgraph schemas into a supergraph schema.

### Step 4. Query your supergraph

To ensure everything is working as expected, you can try querying your router in the Apollo Sandbox that Rover automatically starts up.
You can access your locally running router at [localhost:4000](http://localhost:4000/).

[To-do: Sandbox image]

This tutorial walks you through two sample queries to showcase some of the Sandbox's features:

- Searching for all products that start with "A"
- Getting a user's cart, given their user IDs

#### Search for products

First, you'll search for all products using the `SearchProducts` operation.
The operation takes a `searchInput` argument that lets you filter products by certain criteria.

1. Copy and paste the following operation into the **Operation** window:

```graphQL showLineNumbers=false
# Search all products with some optional filters
query SearchProducts($searchInput: ProductSearchInput!) {
  searchProducts(searchInput: $searchInput) {
    id
    title
    description
    mediaUrl
    variants {
      id
      price
    }
  }
}
```

2. To supply the search criteria, you can use the the **Variables** tab. In the **Variables** tab below the **Operation** window, paste the following JSON:

```JSON showLineNumbers=false
{
  "searchInput": {
    "titleStartsWith": "A"
  }
}
```

3. Click the play button, now labeled with the name of the sample operation, **SearchProducts**.

You should see a response that looks like this:

```JSON showLineNumbers=false
{
  "data": {
    "searchProducts": [
      {
        "id": "product:1",
        "title": "Air Jordan 1 Mid",
        "description": "Air Jordan 1 Mid is a blue, grey and white sneaker from the iconic jordan brand",
        "mediaUrl": "https://sneakernews.com/wp-content/uploads/2022/06/air-jordan-1-mid-university-blue-grey-dx9276-100-6.jpg",
        "variants": [
          {
            "id": "variant:1",
            "price": 600.25
          },
          {
            "id": "variant:2",
            "price": 20.12
          }
        ]
      },
      ...
    ]
  }
}
```

[To-do: Sandbox image]

#### Get user's cart

```graphql
# Get the current user's cart with all the items and their product info as well as the price.
query GetCart {
  user {
    id
    username
    shippingAddress
    cart {
      subtotal
      items {
        price
        inventory {
          inStock
        }
        product {
          title
          description
          mediaUrl
        }
      }
    }
  }
}
```


```text
Headers:
x-user-id: user:1
```

#### Inspect query plans

Sandbox dynamically displays example _query plans_ for your operations in the right-hand panel.
A query plan is a blueprint for dividing a single incoming operation into one or more operations that are each resolvable by a single subgraph.
You can toggle to view the query plan instead of the response by clicking **Response** and selecting **Query Plan Preview**.

[To-do: QP image]

An example query plan for the `GetCart` operation looks something like this:

```showLineNumbers=false
QueryPlan {
  Sequence {
    Fetch(service: "users") {
      {
        user {
          __typename
          id
          username
          shippingAddress
        }
      }
    },
    Flatten(path: "user") {
      Fetch(service: "checkout") {
        {
          ... on User {
            __typename
            id
          }
        } =>
        {
          ... on User {
            cart {
              __typename
              items {
                __typename
                id
              }
              userId
            }
          }
        }
      },
    },
    Parallel {
      Sequence {
        Flatten(path: "user.cart.items.@") {
          Fetch(service: "products") {
            {
              ... on Variant {
                __typename
                id
              }
            } =>
            {
              ... on Variant {
                price
                product {
                  title
                  description
                  mediaUrl
                }
              }
            }
          },
        },
        Flatten(path: "user.cart") {
          Fetch(service: "checkout") {
            {
              ... on Cart {
                __typename
                items {
                  price
                }
                userId
              }
            } =>
            {
              ... on Cart {
                subtotal
              }
            }
          },
        },
      },
      Flatten(path: "user.cart.items.@") {
        Fetch(service: "inventory") {
          {
            ... on Variant {
              __typename
              id
            }
          } =>
          {
            ... on Variant {
              inventory {
                inStock
              }
            }
          }
        },
      },
    },
  },
}
```

As you edit an operation, the Explorer recalculates its example query plan accordingly.
Query plans to help you understand the inner workings of Apollo Federation.

#### Collect and visualize metrics

Operations you run in the Explorer are sent to the GraphOS Router that sits in front of your federated API.
The router automatically collects metrics on those operations and their fields. You can then visualize those metrics in Studio.

Go to your variant's **Insights** page, which looks like this:
<img
  src="./images/insights-quickstart.jpg"
  className="screenshot"
  width="700"
  alt="The Insights page in GraphOS Studio, showing metrics for operations and their fields"
/>
The **Insights** page should already display the operations you executed in the Explorer.
After you update your clients to query your router, this page becomes vital to monitoring your supergraph's performance.

## Next steps

Depending on your goals, you have several options for moving your supergraph closer to production or learning more about GraphOS Studio's capabilities:

- Learn about the available GraphOS insights in the [metrics and reporting documentation](/graphos/metrics).
- Explore other Studio features, including [schema visualization](/graphos/graphs/studio-features#the-schema-page), [proposals](/graphos/delivery/schema-proposals), and [checks](/graphos/delivery/schema-checks).
- Check out the [`rover template`](/rover/commands/template) command to quickly start a new GraphQL project or explore various subgraph implementations.